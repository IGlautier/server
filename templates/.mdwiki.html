 <!DOCTYPE html>
<html>
 <head>
  <link rel="stylesheet" type="text/css" href="http://picosec.org:8080/style.css">
  <meta charset="UTF-8">
  <img id="logo" src="http://picosec.org:8080/logo-text.jpg" width="200px"/>
  <title>{{title}}</title>
 </head>
 <body>
  {{{body}}}
 </body>
 
<script type="text/javascript">
 
$ = function(id){ return document.getElementById(id) };

function encode64(data) {
	r = "";
	for (i=0; i<data.length; i+=3) {
 		if (i+2==data.length) {
			r +=append3bytes(data.charCodeAt(i), data.charCodeAt(i+1), 0);
		} else if (i+1==data.length) {
			r += append3bytes(data.charCodeAt(i), 0, 0);
		} else {
			r += append3bytes(data.charCodeAt(i), data.charCodeAt(i+1), data.charCodeAt(i+2));
		}
	}
	return r;
}

function append3bytes(b1, b2, b3) {
	c1 = b1 >> 2;
	c2 = ((b1 & 0x3) << 4) | (b2 >> 4);
	c3 = ((b2 & 0xF) << 2) | (b3 >> 6);
	c4 = b3 & 0x3F;
	r = "";
	r += encode6bit(c1 & 0x3F);
	r += encode6bit(c2 & 0x3F);
	r += encode6bit(c3 & 0x3F);
	r += encode6bit(c4 & 0x3F);
	return r;
}

function encode6bit(b) {
	if (b < 10) {
 		return String.fromCharCode(48 + b);
	}
	b -= 10;
	if (b < 26) {
 		return String.fromCharCode(65 + b);
	}
	b -= 26;
	if (b < 26) {
 		return String.fromCharCode(97 + b);
	}
	b -= 26;
	if (b == 0) {
 		return '-';
	}
	if (b == 1) {
 		return '_';
	}
	return '?';
}

var deflater = window.SharedWorker && new SharedWorker('rawdeflate.js');
if (deflater) {
	deflater.port.addEventListener('message', done_deflating, false);
	deflater.port.start();
} else if (window.Worker) {
	deflater = new Worker('rawdeflate.js');
	deflater.onmessage = done_deflating;
}

function done_deflating(e) {
	elements = document.getElementsByClassName('uml');
	elements[x].setAttribute('id', encode64(e.data));
	x++;
}

function compress(s) {
	//UTF8
	s = unescape(encodeURIComponent(s));

	if (deflater) {
		if (deflater.port && deflater.port.postMessage) {
			deflater.port.postMessage(s);
		} else {
			deflater.postMessage(s);
		}
  	} else {
 		setTimeout(function() {
      		done_deflating({ data: deflate(s, en) }, 0);
		}, 100);
  	}
}
 window.onload = function () { 
	var elements = document.getElementsByClassName('uml');

	for (var elem = 0; elem<elements.length; elem++) {
		compress(elements[elem].innerText);

		var post = "uml="+encodeURI(elements[elem].innerText);
		xmlhttp=new XMLHttpRequest();
		xmlhttp.open("POST","http://nickallott.com/specChain/uml.php",false);
		xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xmlhttp.send(post);
		xmlDoc=xmlhttp.response;
		elements[elem].innerHTML = xmlDoc;
		
	}
}
 </script>
 </html>